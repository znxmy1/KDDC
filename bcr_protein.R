funct=function(x,y,k,d){
   score=(x+y+k*d-sqrt((x+y+k*d)^2-4*x*y))/2
   print(score)
}
gene1_1=read.csv('bcr_protein1.csv')
gene1=gene1_1
gene1[,3:ncol(gene1_1)]=apply(gene1_1[,3:ncol(gene1_1)],2,function(x){x/sum(x)})

gene2_1=read.csv('bcr_protein2.csv')
gene2=gene2_1
gene2[,3:ncol(gene2_1)]=apply(gene2_1[,3:ncol(gene2_1)],2,function(x){x/sum(x)})

result1<-funct(gene1$CD200,gene2$CD200R1,10,2500)
data<-data.frame(cluster=gene1$cate,state=gene1$CoVID.19.severity)  
data$dui1<-result1
result2<-funct(gene1$PECAM1,gene2$PECAM1,10,12000)
data$dui2<-result2
result3<-funct(gene1$SELL,gene2$SELPLG,10,47000)
data$dui3<-result3
result5<-funct(gene1$SELP,gene2$SELPLG,10,224)
data$dui5<-result5
result7<-funct(gene1$CD2,gene2$CD58,10,10000)
data$dui7<-result7
result8<-funct(gene1$CD40LG,gene2$CD40,10,7)
data$dui8<-result8
result10<-funct(gene1$PVR,gene2$CD226,10,230)
data$dui10<-result10
result11<-funct(gene1$PVR,gene2$TIGIT,10,3)
data$dui11<-result11
result14<-funct(gene1$CD96,gene2$PVR,10,38)
data$dui14<-result14
result15<-funct(gene1$CD80,gene2$CD28,10,2900)
data$dui15<-result15
result16<-funct(gene1$CD86,gene2$CD28,10,19000)
data$dui16<-result16
result17<-funct(gene1$CD80,gene2$CTLA4,10,420)
data$dui17<-result17
result18<-funct(gene1$CD86,gene2$CTLA4,10,2600)
data$dui18<-result18
result19<-funct(gene1$TNF,gene2$TNFRSF1B,10,0.42)
data$dui19<-result19
result22<-funct(gene1$TNFSF4,gene2$TNFRSF4,10,1)
data$dui22<-result22
result23<-funct(gene1$CD70,gene2$CD27,10,0.8)
data$dui23<-result23
result24<-funct(gene1$FASLG,gene2$FAS,10,1.6)
data$dui24<-result24
result25<-funct(gene1$TNFSF9,gene2$TNFRSF9,10,2)
data$dui25<-result25
result26<-funct(gene1$TNFSF14,gene2$TNFRSF14,10,0.18)
data$dui26<-result26
result27<-funct(gene1$TNFSF10,gene2$TNFRSF10A,10,4)
data$dui27<-result27
result28<-funct(gene1$TNFSF10,gene2$TNFRSF10C,10,3.7)
data$dui28<-result28
result29<-funct(gene1$TNFSF13B,gene2$TNFRSF13C,10,0.13)
data$dui29<-result29
result30<-funct(gene1$TNFSF13B,gene2$TNFRSF17,10,0.22)
data$dui30<-result30
result31<-funct(gene1$TNFSF13B,gene2$TNFRSF13B,10,0.27)
data$dui31<-result31
result32<-funct(gene1$VCAM1,gene2$ITGA4,10,40)
data$dui32<-result32
result34<-funct(gene1$ICAM1,gene2$ITGAL,10,500)
data$dui34<-result34
result35<-funct(gene1$ICAM2,gene2$ITGAL,10,600)
data$dui35<-result35
result36<-funct(gene1$ICAM3,gene2$ITGAL,10,25000)
data$dui36<-result36
result38<-funct(gene1$ICAM1,gene2$ITGAM,10,680)
data$dui38<-result38
result39<-funct(gene1$ICAM1,gene2$ITGAX,10,3900)
data$dui39<-result39
result40<-funct(gene1$ICAM3,gene2$ITGAD,10,1900)
data$dui40<-result40
result41<-funct(gene1$VCAM1,gene2$ITGAD,10,8100)
data$dui41<-result41
result42<-funct(gene1$CD274,gene2$CD80,10,1500)
data$dui42<-result42
result43<-funct(gene1$CD274,gene2$PDCD1,10,590)
data$dui43<-result43
result45<-funct(gene1$ULBP3,gene2$KLRK1,10,4000)
data$dui45<-result45
result46<-funct(gene1$SEMA4A,gene2$PLXND1,10,9)
data$dui46<-result46
result47<-funct(gene1$SEMA7A,gene2$PLXNC1,10,350)
data$dui47<-result47
result48<-funct(gene1$BST2,gene2$LILRA4,10,1000)
data$dui48<-result48
result50<-funct(gene1$JAM3,gene2$JAM3,10,9.6)
data$dui50<-result50
result51<-funct(gene1$CD244,gene2$CD48,10,4000)
data$dui51<-result51
result52<-funct(gene1$SLAMF1,gene2$SLAMF1,10,200000)
data$dui52<-result52
result53<-funct(gene1$HLA.E,gene2$KLRC1,10,5000)
data$dui53<-result53
result54<-funct(gene1$HLA.E,gene2$KLRC2,10,28000)
data$dui54<-result54
result55<-funct(gene1$HLA.F,gene2$KIR3DL2,10,118)
data$dui55<-result55
result57<-funct(gene1$HLA.F,gene2$KIR3DL1,10,157)
data$dui57<-result57
result58<-funct(gene1$ALCAM,gene2$ALCAM,10,42000)
data$dui58<-result58
result59<-funct(gene1$ICOSLG,gene2$ICOS,10,24)
data$dui59<-result59
result60<-funct(gene1$CADM1,gene2$CRTAM,10,12500)
data$dui60<-result60
result61<-funct(gene1$HLA.G,gene2$LILRB2,10,4300)
data$dui61<-result61
result62<-funct(gene1$HLA.G,gene2$LILRB1,10,2500)
data$dui62<-result62
result63<-funct(gene1$CSF1,gene2$CSF1R,10,720)
data$dui63<-result63
result67<-funct(gene1$CEACAM1,gene2$CEACAM1,10,7650)
data$dui67<-result67
result68<-funct(gene1$LAIR1,gene2$LILRB4,10,200000)
data$dui68<-result68
result69<-funct(gene1$CEACAM5,gene2$CD8A,10,22)
data$dui69<-result69
result73<-funct(gene1$SEMA4D,gene2$CD72,10,300)
data$dui73<-result73
result74<-funct(gene1$CD6,gene2$ALCAM,10,120)
data$dui74<-result74
result75<-funct(gene1$F11R,gene2$F11R,10,15)
data$dui75<-result75
result76<-funct(gene1$F11R,gene2$ITGAL,10,500)
data$dui76<-result76
result78<-funct(gene1$GP1BA,gene2$ITGAM,10,20000)
data$dui78<-result78
result82<-funct(gene1$FCER2,gene2$CR2,10,263)
data$dui82<-result82
result83<-funct(gene1$THY1,gene2$ITGAX,10,1160)
data$dui83<-result83
result84<-funct(gene1$THY1,gene2$ITGAM,10,2400)
data$dui84<-result84
result89<-funct(gene1$BTLA,gene2$TNFRSF14,10,290)
data$dui89<-result89
result90<-funct(gene1$KLRG1,gene2$CDH1,10,150000)
data$dui90<-result90
result91<-funct(gene1$CD47,gene2$SIRPA,10,2000)
data$dui91<-result91
result92<-funct(gene1$CD47,gene2$SIRPG,10,23000)
data$dui92<-result92
result96<-funct(gene1$SLAMF6,gene2$SLAMF6,10,19700)
data$dui96<-result96
result108<-funct(gene1$CD160,gene2$TNFRSF14,10,340)
data$dui108<-result108
result109<-funct(gene1$TNFSF13,gene2$TNFRSF13B,10,0.91)
data$dui109<-result109
result110<-funct(gene1$TNFSF13,gene2$TNFRSF17,10,0.5)
data$dui110<-result110
result117<-funct(gene1$JAG1,gene2$CD46,10,8000)
data$dui117<-result117
result119<-funct(gene1$CD209,gene2$ICAM3,10,1100)
data$dui119<-result119
result123<-funct(gene1$L1CAM,gene2$L1CAM,10,116)
data$dui123<-result123
result124<-funct(gene1$NCAM1,gene2$FGFR1,10,9970)
data$dui124<-result124
result126<-funct(gene1$NCAM1,gene2$NCAM1,10,55000)
data$dui126<-result126
result139<-funct(gene1$CDH1,gene2$CDH1,10,96500)
data$dui139<-result139
# result140<-funct(gene1$DSG1,gene2$DSC1,10,3550)
# data$dui140<-result140
# result141<-funct(gene1$DSG1,gene2$DSC2,10,21900)
# data$dui141<-result141
# result142<-funct(gene1$DSG1,gene2$DSC3,10,18100)
# data$dui142<-result142
result143<-funct(gene1$DSG2,gene2$DSC1,10,11520)
data$dui143<-result143
result144<-funct(gene1$DSG2,gene2$DSC2,10,29000)
data$dui144<-result144
result145<-funct(gene1$DSG2,gene2$DSC3,10,34400)
data$dui145<-result145
result150<-funct(gene1$SEMA4C,gene2$PLXNB2,10,0.95)
data$dui150<-result150
result152<-funct(gene1$FLT3LG,gene2$FLT3,10,8.7)
data$dui152<-result152
result153<-funct(gene1$EFNB1,gene2$EPHB1,10,0.72)
data$dui153<-result153
result154<-funct(gene1$EFNB1,gene2$EPHB2,10,0.66)
data$dui154<-result154
result155<-funct(gene1$CLEC2D,gene2$KLRB1,10,48000)
data$dui155<-result155
result156<-funct(gene1$CLEC2B,gene2$KLRF1,10,4100)
data$dui156<-result156
#删除na所在的列
data_1=data[,colSums(is.na(data))==0]
write.table(data_1,file="bcr_protein.xlsx",row.names = F,sep="\t")
pipeidui=read.table('pipei1.txt',sep='\t',header=T)
data_1$ming=c("B1",'B2','B3','B4','B5','B6','B7','B8','B9')
rownames(data_1)=data$ming
data1=t(data_1)
data2=data.frame(data1[-c(1:2,86),])
data2$dui=rownames(data2)
he=merge(pipeidui,data2)
# library(dplyr)
# setdiff(data2$dui,pipeidui$dui)
write.table(he,file='bcr_protein_he.xlsx',row.names = F,sep = '\t')
sss=data1[c(1:2,86),]
write.table(sss,file = 'bcr_xinxi.xlsx',row.names = F,sep = '\t')


